# ğŸ›¡ï¸ BGP-Sentry: Expanding BGP Trust to Non-RPKI ASes via  RPKI-enabled ASes as Observers

## ğŸ“š Overview
**BGP-Sentry** is a blockchain-based simulation framework designed to secure and audit BGP announcements beyond RPKI coverage. It leverages RPKI-enabled Autonomous Systems (ASes), which represent approximately 60% of global ASes, as observers to validate the behavior of neighboring non-RPKI ASes.

The system employs a dual-blockchain architecture:
- **Blockchain A**: A permissioned local ledger where RPKI nodes validate and record BGP announcements.
- **Blockchain B**: A public blockchain (e.g., Ethereum) hosting smart contracts that enable non-RPKI nodes to stake USDC tokens for credibility.

Each non-RPKI AS is assigned a dynamic trust score and classified into tiers:
- **Trusted** (â‰¥ 80)
- **Under Observation** (30â€“79)
- **Distrusted** (â‰¤ 30)

RPKI nodes collect announcements from simulated router logs (generated by Mininet), assess them via verification and historical behavior analysis, and then enforce security using both real-time penalties and periodic trust score updates.

> Note: In this simulation, BGP announcements are not directly emitted by non-RPKI nodes but are generated through Mininet and parsed into each AS's `network_stack/` as if they originated from actual routers.


## ğŸ“ Folder & File Structure
```
BGP_ANNOUNCEMENT_RECORDER/
|
â”œâ”€â”€ bgp_feed/
â”‚   â””â”€â”€ mininet_logs/                 # BGP logs from simulated routers (used as input)
|
â”œâ”€â”€ nodes/
â”‚   â”œâ”€â”€ rpki_nodes/
â”‚   â”‚   â”œâ”€â”€ as01/, as03/, ..., as19/      # Each RPKI AS node
â”‚   â”‚   â”‚   â”œâ”€â”€ blockchain_node/         # Blockchain logic
â”‚   â”‚   â”‚   â””â”€â”€ network_stack/           # Stores BGP log entries for each AS
â”‚   â”‚   â”œâ”€â”€ rpki_verification_system/     # Prefix and path validation logic
â”‚   â”‚   â””â”€â”€ shared_blockchain_stack/
â”‚   â”‚       â”œâ”€â”€ block_proposer/          # Proposes new blocks
â”‚   â”‚       â”œâ”€â”€ concensus_engine/        # Validates and agrees on transactions
â”‚   â”‚       â”œâ”€â”€ shared_data/
â”‚   â”‚       â”‚   â”œâ”€â”€ chain/               # Blockchain A (private ledger)
â”‚   â”‚       â”‚   â”œâ”€â”€ shared_registry/     # Trusted AS registry
â”‚   â”‚       â”‚   â””â”€â”€ state/               # Trust scores, staking info
â”‚   â”‚       â””â”€â”€ utils/
â”‚   â”‚           â”œâ”€â”€ stake_engine/        # Reads USDC staking data from Blockchain B
â”‚   â”‚           â””â”€â”€ trust_engine/        # Updates trust scores based on logs
â”‚   â””â”€â”€ non_rpki_nodes/                # Not used for generating logs in current version
|
â”œâ”€â”€ smart_contract/                       # Blockchain B (public) staking system
â”‚   â”œâ”€â”€ contracts/                     # Solidity source
â”‚   â”œâ”€â”€ scripts/                       # Deployment/test scripts
â”‚   â””â”€â”€ test/                          # Smart contract unit tests
|
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
```

---

## ğŸ”„ Data Flow Summary
```
[Mininet BGP Simulation]
      â†³ bgp_feed/mininet_logs/
            â†³ Parsed into: nodes/rpki_nodes/*/network_stack/
                  â†³ Announcements validated (prefix, AS-path)
                        â†³ Trust and stake checked
                              â†³ Written to shared_blockchain_stack/shared_data/chain/
                              â†³ Trust score updated in shared_data/state/
```

---

## ğŸ” Trust Architecture

### âœ… Trust Score Model
- **Initial trust** for non-RPKI nodes = 70
- **Minimum accepted trust** = 70
- **Penalty for hijack** = -30 (immediate)
- **Periodic adjustment**:
  - Reward: +5 per good cycle
  - Penalty: -10 per suspicious cycle
- **Stake-based boost**:
  - Stake 100 USDC if trust â‰¥ 50 and < 70
  - Temporary boost: +20

### ğŸ”‘ Trust Engine Logic
Located in:
```
nodes/rpki_nodes/shared_blockchain_stack/utils/trust_engine/
```
- Applies real-time penalties (e.g., for hijacks)
- Performs periodic trust adjustment (e.g., monthly)

---

## âš–ï¸ Blockchain Models

### â›“ï¸ Blockchain A (TrustChain)
- Permissioned private chain
- Stores full BGP announcement records
- Operated by RPKI-enabled nodes
- Located in:
```
nodes/rpki_nodes/shared_blockchain_stack/shared_data/chain/
```

### â‚µ Blockchain B (Public USDC Staking)
- Smart contract on Ethereum/Solana
- Allows non-RPKI nodes to stake USDC
- Used for trust boosting
- Interacted with by `stake_engine/`

---

## ğŸ”® How to Run

### 1. Set up Environment
```bash
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

### 2. Generate BGP Logs
```bash
python bgp_feed/mininet_logs/simulator.py
```
> Simulated announcements will be written to `nodes/rpki_nodes/*/network_stack/`

### 3. Run RPKI Node
```bash
python nodes/rpki_nodes/as01/blockchain_node/main.py --asn 65001
```

### 4. Update Trust Scores
```bash
python nodes/rpki_nodes/shared_blockchain_stack/utils/trust_engine/main.py
```

### 5. Deploy Smart Contract (Blockchain B)
```bash
cd smart_contract/
python scripts/deploy_and_test.py
```
More on the readme file of the smart contract folder.

---

## ğŸ”’ Announcement Format
```json
{
  "asn": 65010,
  "prefix": "203.0.113.0/24",
  "as_path": [65010, 65001],
  "next_hop": "10.0.0.1",
  "timestamp": 1723455678,
  "type": "announce",
  "endorsed_by": 65001,
  "signature": "base64sig"
}
```

---

## ğŸ’¼ Major Responsibilities
| Component Path | Description |
|----------------|-------------|
| `blockchain_node/` | Proposes blocks, validates and writes announcements |
| `shared_blockchain_stack/` | Manages Blockchain A: proposing, consensus, logging |
| `trust_engine/` | Adjusts trust scores using logs and penalties |
| `stake_engine/` | Reads on-chain stake data from Blockchain B |
| `network_stack/` | Receives and stores simulated BGP logs |
| `bgp_feed/mininet_logs/` | Generator of all BGP test input logs (Not being used now)|
| `shared_data/` | Stores blockchain chain, trust state, and registries |

---

## ğŸ§  Realism Assumptions
- Each `asXX/` folder models a router stack (Mininet + validation agent)
- All announcements come from **Mininet logs**, not directly from non-RPKI nodes
- Only **RPKI first-hop nodes** write to the blockchain
- Withdrawals and hijacks follow the same logging and trust rules

---

## ğŸ“„ For Research or Reports
- Emphasize dual blockchain design
  - Blockchain A: permissioned, local
  - Blockchain B: public, stake-based
- Trust score is dynamic and based on behavior
- Mininet simulates real-world topology and attack scenarios

---

## ğŸ‘¨â€ğŸ’¼ Author
**Anik Tahabilder**  
Blockchain Researcher | PhD Student | Smart Contract Security Architect  
*Project Lead and System Architect of BGP TrustChain*