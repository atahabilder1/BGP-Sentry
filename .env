# =============================================================================
# BGP-Sentry Configuration — Tunable Hyperparameters
# =============================================================================
# All simulation parameters in one place for easy experimentation.
# Modify values here and re-run `python3 main_experiment.py --dataset <name>`
# without changing any source code.
#
# ALL time values are in SECONDS unless otherwise noted.
# [coins] = BGPCOIN tokens, [score] = trust-score points (0-100).
# =============================================================================


# =============================================================================
# GROUP A: CONSENSUS & P2P NETWORK
# =============================================================================

# ── Consensus Threshold ──
# Minimum RPKI peer signatures to commit a block.
# Formula: max(MIN, min(N/3+1, CAP)) where N = RPKI node count.
CONSENSUS_MIN_SIGNATURES=3
CONSENSUS_CAP_SIGNATURES=5

# ── P2P Timeouts [seconds] ──
# How long the MERGER waits for SIGNER votes before giving up.
# If 3+ approve votes arrive before timeout → block is committed (final).
# If timeout expires → commit with partial status or single-witness.
P2P_REGULAR_TIMEOUT=3              # Normal BGP announcements [seconds]
P2P_ATTACK_TIMEOUT=5               # Attack-related transactions [seconds]

# ── P2P Broadcast ──
# Max peers to send vote requests to per transaction.
# Must be >= CONSENSUS_MIN_SIGNATURES. Lower = faster, higher = more redundancy.
P2P_MAX_BROADCAST_PEERS=5

# Base port for TCP sockets (only used when use_memory_bus=False).
P2P_BASE_PORT=8000


# =============================================================================
# GROUP B: DEDUPLICATION & SKIP WINDOWS
# =============================================================================
# When a node sees the same (prefix, origin_asn) announcement within the
# skip window AND it is NOT an attack, the node skips it entirely —
# no validation, no consensus, no blockchain write.
# Attacks ALWAYS bypass dedup and are processed immediately.

# RPKI nodes: skip duplicate legitimate announcements within this window.
# For a 28-minute simulation, 240s (4 min) means each legitimate
# (prefix, origin) is processed at most ~7 times.
RPKI_DEDUP_WINDOW=300              # [seconds] (5 minutes)

# Non-RPKI observer nodes: skip duplicate legitimate announcements.
# Shorter window because observers are cheaper (no consensus overhead).
NONRPKI_DEDUP_WINDOW=120           # [seconds] (2 minutes)

# P2P transaction pool sampling window: the pool's own dedup for
# knowledge-base entries. Should be >= RPKI_DEDUP_WINDOW.
SAMPLING_WINDOW_SECONDS=300        # [seconds] (matches RPKI_DEDUP_WINDOW)


# =============================================================================
# GROUP C: KNOWLEDGE BASE (per-node observation memory for voting)
# =============================================================================
# Each RPKI node (SIGNER) maintains a knowledge base of recently observed
# BGP announcements. When a MERGER asks for a vote, the signer checks
# its knowledge base: if the announcement is there → approve, else → reject.

# How long observations stay in the knowledge base [seconds].
KNOWLEDGE_WINDOW_SECONDS=480       # [seconds] (8 minutes)

# How often to garbage-collect expired observations [seconds].
KNOWLEDGE_CLEANUP_INTERVAL=60      # [seconds]


# =============================================================================
# GROUP D: BUFFER & CAPACITY LIMITS
# =============================================================================
# Hard caps to prevent unbounded memory growth during long simulations.

# Per-node ingestion buffer for normal (non-attack) announcements.
# At 60% full, probabilistic sampling kicks in. Attacks bypass the buffer.
INGESTION_BUFFER_MAX_SIZE=1000

# Max pending transactions awaiting consensus before oldest are force-timed-out.
PENDING_VOTES_MAX_CAPACITY=5000

# Max committed transaction IDs tracked (prevents unbounded dict growth).
COMMITTED_TX_MAX_SIZE=50000

# How often to garbage-collect old committed transaction IDs [seconds].
COMMITTED_TX_CLEANUP_INTERVAL=300  # [seconds] (5 minutes)

# Max observations in the knowledge base before oldest are trimmed.
KNOWLEDGE_BASE_MAX_SIZE=50000

# Max entries in the last-seen sampling cache before oldest are evicted.
LAST_SEEN_CACHE_MAX_SIZE=100000


# =============================================================================
# GROUP E: ATTACK DETECTION
# =============================================================================

# ── Route Flapping Detection ──
# Sliding window: count unique state changes for (prefix, origin).
FLAP_WINDOW_SECONDS=60             # [seconds]

# More than this many state changes in the window = ROUTE_FLAPPING.
# Higher = fewer false positives.
FLAP_THRESHOLD=5

# Observations arriving within this interval are treated as same event.
FLAP_DEDUP_SECONDS=2               # [seconds]

# ── Attack Consensus (voting on detected attacks) ──
# Min votes needed to finalize an attack verdict.
ATTACK_CONSENSUS_MIN_VOTES=3

# Rewards/penalties for attack consensus participation [coins].
ATTACK_CONSENSUS_REWARD_DETECTION=10
ATTACK_CONSENSUS_REWARD_CORRECT_VOTE=2
ATTACK_CONSENSUS_PENALTY_FALSE_ACCUSATION=-20


# =============================================================================
# GROUP F: BGPCOIN TOKEN ECONOMY
# =============================================================================
# Total token supply. Treasury starts with this amount; rewards drain it.
BGPCOIN_TOTAL_SUPPLY=10000000      # [coins]

# ── Rewards [coins] ──
BGPCOIN_REWARD_BLOCK_COMMIT=10
BGPCOIN_REWARD_VOTE_APPROVE=1
BGPCOIN_REWARD_FIRST_COMMIT_BONUS=5
BGPCOIN_REWARD_ATTACK_DETECTION=100
BGPCOIN_REWARD_DAILY_MONITORING=10

# ── Penalties [coins] (applied as negative values) ──
BGPCOIN_PENALTY_FALSE_REJECT=2
BGPCOIN_PENALTY_FALSE_APPROVE=5
BGPCOIN_PENALTY_MISSED_PARTICIPATION=1

# ── Multiplier ranges (min, max) ──
# Applied to base rewards based on node history.
BGPCOIN_MULTIPLIER_ACCURACY_MIN=0.5
BGPCOIN_MULTIPLIER_ACCURACY_MAX=1.5
BGPCOIN_MULTIPLIER_PARTICIPATION_MIN=0.8
BGPCOIN_MULTIPLIER_PARTICIPATION_MAX=1.2
BGPCOIN_MULTIPLIER_QUALITY_MIN=0.9
BGPCOIN_MULTIPLIER_QUALITY_MAX=1.3


# =============================================================================
# GROUP G: NON-RPKI TRUST RATING SYSTEM
# =============================================================================
# Score range and initial value [score points, 0-100].
RATING_INITIAL_SCORE=50
RATING_MIN_SCORE=0
RATING_MAX_SCORE=100

# ── Penalties per attack type [score points] ──
RATING_PENALTY_PREFIX_HIJACK=-20
RATING_PENALTY_SUBPREFIX_HIJACK=-18
RATING_PENALTY_BOGON_INJECTION=-25
RATING_PENALTY_ROUTE_FLAPPING=-10
RATING_PENALTY_ROUTE_LEAK=-15
RATING_PENALTY_REPEATED_ATTACK=-30
RATING_PENALTY_PERSISTENT_ATTACKER=-50

# ── Rewards [score points] ──
RATING_REWARD_MONTHLY_GOOD_BEHAVIOR=5
RATING_REWARD_FALSE_ACCUSATION_CLEARED=2
RATING_REWARD_PER_100_LEGITIMATE=1
RATING_REWARD_HIGHLY_TRUSTED_BONUS=10

# ── Trust classification thresholds [score points] ──
RATING_THRESHOLD_HIGHLY_TRUSTED=90
RATING_THRESHOLD_TRUSTED=70
RATING_THRESHOLD_NEUTRAL=50
RATING_THRESHOLD_SUSPICIOUS=30


# =============================================================================
# GROUP H: TRANSACTION BATCHING
# =============================================================================
# Group multiple consensus-approved transactions into a single blockchain block.
# This reduces disk I/O (fewer _save_blockchain calls) and block replication
# messages (one batch block vs N individual blocks).
#
# BATCH_SIZE=1 means no batching (current behavior, each tx = one block).
# BATCH_SIZE=10 means accumulate up to 10 transactions before writing a block.
# BATCH_TIMEOUT is the max wait before flushing a partial batch [seconds].
#
# Expected throughput gain: 3-5x at BATCH_SIZE=10, proportional to fewer I/O.
BATCH_SIZE=1                       # [count] transactions per batch block (1 = no batching)
BATCH_TIMEOUT=0.5                  # [seconds] max wait before flushing partial batch


# =============================================================================
# GROUP I: SIMULATION TIMING
# =============================================================================
# Speed multiplier: 1.0 = real-time (BGP seconds = wall-clock seconds).
# Set higher for faster testing (e.g. 100.0 = 100x faster).
SIMULATION_SPEED_MULTIPLIER=1.0
